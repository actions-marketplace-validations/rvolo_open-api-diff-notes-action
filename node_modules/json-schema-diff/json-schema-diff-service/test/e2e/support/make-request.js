'use strict';

const request = require('request');
const _ = require('lodash');

module.exports = (userOptions) => new Promise((resolve, reject) => {
    const defaultOptions = {
        baseUrl: 'http://localhost:8080',
        expectedStatusCode: 200,
        json: true,
        method: 'GET'
    };
    const options = _.defaults(userOptions, defaultOptions);

    request(options, (error, response, body) => {
        if (error) {
            reject(error);
        } else if (response.statusCode !== options.expectedStatusCode) {
            reject(new Error(`Expected statusCode to be ${options.expectedStatusCode} ` +
                `but found ${response.statusCode}`));
        } else {
            resolve({
                body,
                response
            });
        }
    });
});
