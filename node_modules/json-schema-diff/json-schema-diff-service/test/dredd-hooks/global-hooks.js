'use strict';

const hooks = require('hooks');
const startServer = require('../e2e/support/start-server');
const waitForCondition = require('../e2e/support/wait-for-condition');

let server;

hooks.beforeAll((_, done) => {
    startServer(8081)
        .then((newServer) => {
            server = newServer;
            return waitForCondition(server.isReady, 5000);
        })
        .then(done, done.fail);
});

hooks.beforeEach((transaction, done) => {
    transaction.skip = transaction.expected.statusCode === '500';
    done();
});

hooks.afterAll((_, done) => {
    server.stop();
    console.log(server.getLogLines());
    done();
});
